# 简易成绩管理系统（Vue3 + TS + Pinia + Router + Element Plus）课程设计规划

---

## 0. 术语说明（避免沟通歧义）

- **课程（Course）**：课程基础信息，如“高等数学”。不包含学期、教师、上课时间地点。
- **开课/排课（Offering）**：某课程在某学期的一次开设，如“高等数学（2025-2026-1），张三，周一1-2节，1-16周，A101，容量60”。
- **选课（Enrollment）**：学生选了哪条开课记录。
- **成绩（Grade）**：学生在某条开课记录上的分数；带状态（草稿/已发布）。
- **Tabs（标签页）**：同一页面内的“分栏切换组件”，例如“课程详情页”内切换【学生名单】与【成绩管理】两个视图；不会跳转新页面，只切换内容区。

---

## 1. 角色与权限

### 1.1 角色
- 学生（Student）
- 教师（Teacher）
- 管理员（Admin）

### 1.2 权限边界（必须明确）
- 学生：仅能查看/修改自己的个人信息；仅能选退自己的课；仅能查看**已发布**成绩；课表仅展示自己已选课程。
- 教师：仅能查看自己被分配的开课记录；仅能管理自己课程的学生名单与成绩；发布成绩后学生可见。
- 管理员：可管理学生、教师、课程、开课/排课、选课信息；可处理忘记密码申请并重置密码。

---

## 2. 全局信息架构（Layout）

### 2.1 通用布局
- 左侧：角色菜单（按权限动态渲染）
- 顶部：面包屑 + 用户头像下拉（个人中心 / 修改密码 / 退出）
- 内容区：各业务页面

### 2.2 首页（按角色不同内容）
首页不是“完全通用”，建议定义为 **Role-based Home（角色首页）**：
- 路由统一为 `/home`，进入时根据角色展示不同卡片与快捷入口；

---

## 3. 页面清单与路由（建议版本）

### 3.1 认证相关
- `/login` 登录页（身份选择 + 账号密码）
- `/forgot-password` 忘记密码（提交重置申请）

### 3.2 公共页面
- `/profile` 个人中心（查看与修改个人信息 + 修改密码）

### 3.3 学生端
- `/home` 角色首页（学生卡片）
- `/student/select-courses` 选课页（针对 Offering）
- `/student/timetable` 学期课表（按周次范围展示）
- `/student/grades` 成绩查询（仅已发布）

### 3.4 教师端
- `/home` 角色首页（教师卡片）
- `/teacher/my-offerings` 我的课程（Offering 列表）
- `/teacher/offering/:offeringId` 课程详情页（Tabs：学生名单 / 成绩管理）

### 3.5 管理员端
- `/home` 角色首页（管理员卡片）
- `/admin/students` 学生管理（CRUD + 重置密码）
- `/admin/teachers` 教师管理（CRUD + 重置密码）
- `/admin/courses` 课程管理（CRUD）
- `/admin/offerings` 开课/排课管理（CRUD）
- `/admin/enrollments` 选课信息管理（按 Offering 查名单，可移除选课）
- `/admin/password-resets` 重置申请管理（处理忘记密码请求）

---

## 4. 页面规格（每页：目的 + UI组成 + 交互 + 校验 + 数据变更）

> 统一约定：列表页使用 Element Plus 表格（ElTable），新增/编辑使用弹窗（ElDialog + ElForm），删除使用确认框（ElMessageBox）。

### 4.1 登录页 `/login`
**目的**：让三类用户进入各自系统区域。  
**UI**：

- 身份选择：Radio/Tab（学生/教师/管理员）
- 账号输入：学号/工号/管理员账号
- 密码输入
- “忘记密码”链接
**交互**：
1. 选择身份 → 输入账号密码 → 点击登录
2. 登录成功：跳转 `/home`
3. 登录失败：提示错误信息
**校验**：
- 账号、密码必填
**数据变更**：
- 保存 token/用户信息（Pinia + localStorage）
- 路由守卫根据 token 放行

---

### 4.2 忘记密码 `/forgot-password`
**目的**：不做短信/邮箱验证，采用“管理员重置”闭环。  
**UI**：
- 身份选择
- 账号（学号/工号）
- 姓名（可选但建议必填，便于管理员核对）
- 备注（可选）
- 提交按钮
**交互**：
1. 提交 → 创建一条“重置申请”
2. 提示：“已提交申请，请联系管理员重置”
3. 返回登录页
**校验**：
- 身份、账号必填；姓名建议必填
**数据变更**：
- 新增 PasswordResetRequest（状态：待处理）

---

### 4.3 个人中心 `/profile`
**目的**：查看详情 + 修改个人信息 + 修改密码。  
**UI**：
- 信息展示卡片：姓名、账号、角色、班级/院系、联系方式（手机/邮箱）
- 编辑按钮：进入可编辑态
- 修改密码区：原密码、新密码、确认新密码
**交互**：
- 修改个人信息：保存后提示成功
- 修改密码：成功后提示（可选：强制重新登录）
**校验**：
- 新密码与确认一致；长度校验（例如 ≥6）
**数据变更**：
- 更新 UserProfile / PasswordHash

---

## 5. 学生端页面规格

### 5.1 学生角色首页 `/home`
**目的**：欢迎 + 信息展示。  
**展示建议**：

- 欢迎语：欢迎，{name}
- 信息卡片：已选课程数、本学期学分总计（若实现学分）、待发布成绩数（基于草稿/发布状态）等自由发挥，可做可视化图形

---

### 5.2 选课页 `/student/select-courses`
**目的**：对开课记录 Offering 进行选课/退课。  
**UI**：
- 筛选区：学期（默认当前学期）、关键字（课程名/教师）
- 开课列表（表格字段建议）：
  - 课程名、教师、时间（周几+节次）、周次（1-16）、地点、容量/已选、状态、操作
- 详情抽屉（Drawer）：展示该 Offering 详细信息
**交互**：
1. 点击某行 → 打开详情抽屉

2. 点击“选课”：
   - 校验未满员
   - 校验时间冲突（与自己已选 Offering 比较星期+节次+周次范围）
   - 成功：提示“选课成功”，按钮变“退课”，已选人数 +1
   
3. 点击“退课”：
   - 二次确认 → 成功提示“退课成功”，已选人数 -1

     **数据变更**：
- 新增/删除 Enrollment
- 影响课表展示来源（课表以 Enrollment 为准）

---

### 5.3 课表页 `/student/timetable`
**目标**：学期课表，体现“课程 1-16 周”的周次范围。  
**UI**：
- 学期选择
- 周课表网格：周一~周日 × 节次（可固定 1-10）
- 每格显示：课程名（必要时加地点缩写）
**交互**：
- 点击某课程格子 → 弹窗显示：课程名、教师、地点、周次范围、节次
**数据来源**：
- 仅展示已选 Offering（Enrollment 关联）

---

### 5.4 成绩页 `/student/grades`
**目标**：学生查看成绩（仅已发布）。  
**UI**：
- 学期筛选
- 成绩列表字段建议：课程名、教师、分数、状态（显示已发布和“待发布”但不展示分数）
**交互**：
- 切换学期刷新列表
  **数据规则**：
- 未发布成绩：（返回但 score 为空并显示“待发布”）

---

## 6. 教师端页面规格

### 6.1 教师角色首页 `/home`
**展示建议**：
- 欢迎语：欢迎，{name}
- 信息卡片（可选）：本学期授课课程数、待发布课程数（存在草稿成绩的 Offering 数）等自由发挥

---

### 6.2 我的课程 `/teacher/my-offerings`
**目标**：教师查看自己授课的开课记录 Offering。  
**UI**：

- 学期筛选
- 列表字段建议：课程名、班级/教学班、时间地点、人数、操作（进入）
**交互**：
- 点击“进入” → 跳转 `/teacher/offering/:offeringId`

---

### 6.3 课程详情 `/teacher/offering/:offeringId`（Tabs：名单 / 成绩）
**Tabs 结构**：
- Tab 1：学生名单
- Tab 2：成绩管理

#### Tab 1：学生名单
- 表格：学号、姓名、班级
- 可选：搜索

#### Tab 2：成绩管理（核心）
**UI**：

- 表格：学号、姓名、分数输入框（ElInputNumber 0-100）、状态
- 顶部按钮：
  - 保存草稿
  - 发布成绩
  **交互**：
1. 教师批量录入/修改成绩
2. 点击“保存草稿”：
   - 保存当前成绩（状态=草稿）
   - 提示“已保存草稿”
3. 点击“发布成绩”：
   - 二次确认 → 发布（状态=已发布）
   - 提示“已发布，学生可查看”
   **规则**：
- score 必须 0-100
- 发布后允许修改与否
  - 简化方案：发布后仍允许修改，但修改后保持已发布（学生可见最新）

---

## 7. 管理员端页面规格

### 7.1 管理员角色首页 `/home`
**展示建议**：
- 欢迎语：欢迎，{name}
- 卡片：学生总数、教师总数、课程总数、开课总数、重置申请待处理数

---

### 7.2 学生管理 `/admin/students`
**CRUD 字段建议**：
- 学号、姓名、班级
**交互**：
- 新增/编辑：弹窗表单
- 删除、批量删除：二次确认
- 重置密码：行内按钮 → 确认 → 重置为默认密码（例如 `123456`）
**校验**：
- 学号唯一
- 学号、姓名必填

---

### 7.3 教师管理 `/admin/teachers`
同学生管理：
- 工号唯一
- 重置密码功能同样提供

---

### 7.4 课程管理 `/admin/courses`
**字段建议**：

- 课程号、课程名、学分（可选）
**交互**：
- CRUD

---

### 7.5 开课/排课管理 `/admin/offerings`
**目标**：把课程分配给教师，并设置学期、时间地点、周次与容量。  
**字段建议**：
- 学期（如 2025-2026-1）
- 课程（courseId）
- 教师（teacherId）
- 教学班/班级标识（可选：如 “计科2301”）
- 星期（1-7）
- 节次范围（如 1-2）
- 周次范围（startWeek-endWeek，如 1-16）
- 地点
- 容量（capacity）
**交互**：
- 新增/编辑弹窗选择课程与教师
- 删除：二次确认

---

### 7.6 选课信息管理 `/admin/enrollments`
**目标**：按开课记录查看选课名单、必要时移除选课。  
**UI/交互建议（两栏式最清晰）**：
- 左侧：Offering 列表（学期筛选）
- 右侧：选课学生名单
- 行内操作：移除该学生选课（确认后强制删除 Enrollment）
**规则**：
- 移除后学生课表与成绩视图同步变化

---

### 7.7 重置申请管理 `/admin/password-resets`
**目标**：管理员处理忘记密码请求。  
**UI**：
- 列表：申请人角色、账号、姓名、提交时间、状态（待处理/已处理）
- 操作：重置密码、标记处理
**交互**：
1. 管理员点“重置密码” → 确认 → 系统生成新密码（默认或随机）
2. 标记为已处理（记录处理时间/处理人可选）
---

## 8. 核心业务流程（端到端）

### 8.1 初始化流程（管理员）
1. 管理员登录
2. 新增学生、教师
3. 新增课程
4. 创建开课/排课（Offering）
5. 系统即可开放给学生选课、教师录成绩

### 8.2 学生选课与课表生成
1. 学生登录 → `/home`
2. 进入选课页 → 查看 Offering 列表 → 点击选课
3. 系统校验：容量 + 时间冲突 → 成功提示
4. 学生进入课表页 → 自动根据 Enrollment 渲染学期课表

### 8.3 教师录入与发布成绩
1. 教师登录 → 我的课程
2. 进入某 Offering 课程详情 → 成绩管理 Tab
3. 录入/修改成绩 → 保存草稿
4. 确认无误 → 发布成绩
5. 学生端成绩页可见该课程成绩

### 8.4 忘记密码闭环
1. 用户登录页点“忘记密码” → 提交申请
2. 管理员在“重置申请管理”查看待处理
3. 管理员重置密码 → 通知用户（线下即可）
4. 用户登录后到个人中心修改密码

---

## 9. 数据模型（概念级，便于后续定表）

> 此处仅定义“有哪些表/对象”，字段可后续再定；但建议保留唯一性与关联关系，避免后期推翻。

### 9.1 UserAccount（账号）
- id
- role（student/teacher/admin）
- username（学号/工号/管理员账号）
- passwordHash
- profileId（关联 Student/Teacher/AdminProfile）

### 9.2 Student
- id, studentNo, name, className, phone/email

### 9.3 Teacher
- id, teacherNo, name, dept, phone/email

### 9.4 Course
- id, courseCode, name, credit

### 9.5 Offering（开课/排课）
- id, term, courseId, teacherId
- weekRange（startWeek/endWeek）
- timeSlot（weekday + startPeriod/endPeriod）
- location, capacity
- classLabel

### 9.6 Enrollment（选课）
- id, offeringId, studentId
- 唯一约束：同一学生同一 offering 不可重复

### 9.7 Grade（成绩）
- enrollmentId
- score
- status（draft/published）
- updatedAt
- 唯一约束：同一 studentId + offeringId 唯一

### 9.8 PasswordResetRequest（重置申请）
- id, role, username, name, remark, status（pending/done）, createdAt, handledAt（可选）

---

## 10. 规则与校验
- 选课：
  - 容量校验：已选 < capacity
  - 时间冲突：同学期内已选 offering 与目标 offering 的 weekday+period 重叠且周次范围重叠 → 不允许
- 成绩：
  - score 在 0-100
  - 发布后学生端可见
- 账号：
  - username 唯一
  - 修改密码必须校验原密码正确

---
